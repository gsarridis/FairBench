<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Emmanouil (Manios) Krasanakis" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Report manipulation - FairBench</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../theme_extend.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Report manipulation";
        var mkdocs_page_input_path = "advanced\\manipulation.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../fairbench.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Quickstart</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Basics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../basics/forks/">Forks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../basics/reports/">Reports</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../basics/interactive/">Interactive visualization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../basics/modelcards/">Stamps and model cards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../metrics/">Performance metrics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ml_integration/">ML Integration</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Report manipulation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#editing-metrics">Editing metrics</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reduction">Reduction</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../distributed/">Computational branches</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">FairBench</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Advanced &raquo;</li>
      <li>Report manipulation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="report-manipulation">Report manipulation</h1>
<ol>
<li><a href="#manipulating-metrics">Manipulating metrics</a></li>
<li><a href="#reduction">Reduction</a></li>
<li><a href="#combining-and-comparing-reports">Combining and comparing reports</a></li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To extract popular fairness definitions
from reports, process them with
<a href="../../basics/modelcards/#stamps">stamps</a>.</p>
</div>
<h2 id="editing-metrics">Editing metrics</h2>
<p>Reports are forks of dictionaries and you can use normal
dictionary methods to access and edit their elements (given
that forks provide access to any possible methods of internal
objects). For instance, you can use the following code
to calculate a notion of total disparate mistreatment as the sum
of <em>dfnr</em> and <em>dfpr</em> of a binary report in all brnaches
and remove these entries from all branch
dictionaries using Python's dictionary entry deletion:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">fairbench</span> <span class="k">as</span> <span class="nn">fb</span>

<span class="n">sensitive</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">Fork</span><span class="p">(</span><span class="n">case1</span><span class="o">=...</span><span class="p">,</span> <span class="n">case2</span><span class="o">=...</span><span class="p">)</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">binreport</span><span class="p">(</span><span class="n">predictions</span><span class="o">=...</span><span class="p">,</span> <span class="n">labels</span><span class="o">=...</span><span class="p">,</span> <span class="n">sensitive</span><span class="o">=</span><span class="n">sensitive</span><span class="p">)</span>
<span class="n">fb</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

<span class="n">report</span><span class="p">[</span><span class="s2">&quot;mistreatment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">dfpr</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">dfnr</span><span class="p">)</span>
<span class="k">del</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;dfpr&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;dfnr&quot;</span><span class="p">]</span>
<span class="n">fb</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</code></pre></div>
<p>This will print the following to the console:</p>
<div class="highlight"><pre><span></span><code>Metric          case2           case1          
accuracy        0.938           0.938          
prule           0.667           0.571          
dfpr            0.056           0.071          
dfnr            0.167           0.500          

Metric          case2           case1          
accuracy        0.938           0.938          
prule           0.667           0.571          
mistreatment    0.222           0.571
</code></pre></div>
<h2 id="reduction">Reduction</h2>
<p>Reports can be reduced alongside branches. Again,
this operation is in general applicable to all variable forks,
although this time usage is discouraged outside of 
report manipulation, as reduction creates new -and potentially 
unforeseen- data branches, but constitutes the main mechanism
for summarizing multi-attribute reports into one measure.
Reduction internally runs three types of functions obtained
from its arguments:</p>
<ul>
<li><code>transform</code> values found in the report for each metric, which can be either <em>None</em> or <em>abs</em>.</li>
<li><code>expand</code> the list of branch values for each metric, namely <em>None</em>, a pairwise <em>ratio</em> between values, or absolute <em>diff</em>erences between branch values.</li>
<li><code>reducer</code> method that takes a list of all branch values for each metric and summarizes them into one value. These can be <em>mean,max,min,sum,budget</em>, where the last one is the logarithm of the maximum declared in differential fairness formulations.</li>
</ul>
<p>To demonstrate usage,
we compute the mean, and budget of the absolute value ratio
via the following code.
Reduction creates new reports that comprise only one branch.
The branch's name is dynamically derived by parameters 
(e.g., <em>"budgetratioabs"</em>), but you can also set 
a specific one with the argument <code>name="ReductionName"</code>. </p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">fairbench</span> <span class="k">as</span> <span class="nn">fb</span>

<span class="n">sensitive</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">Fork</span><span class="p">(</span><span class="n">case1</span><span class="o">=...</span><span class="p">,</span> <span class="n">case2</span><span class="o">=...</span><span class="p">)</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">accreport</span><span class="p">(</span><span class="n">predictions</span><span class="o">=...</span><span class="p">,</span> <span class="n">labels</span><span class="o">=...</span><span class="p">,</span> <span class="n">sensitive</span><span class="o">=</span><span class="n">sensitive</span><span class="p">)</span>

<span class="n">mean_across_branches</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">fb</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">)</span>
<span class="n">max_abs_across_branches</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">fb</span><span class="o">.</span><span class="n">budget</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="n">fb</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">fb</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You will typically want to perform custom reductions on
an <em>accreport</em> or on manually generated reports for 
some base evaluation measures. Combine the 
outcome of more than one reduction for better understanding.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Call <code>areduce</code> with the same arguments to 
obtain the reduction's numeric output instead of a fork.</p>
</div>
<h1 id="combining-and-comparing-reports">Combining and comparing reports</h1>
<p>Reports, including reduced ones, can be combined to
create a super-report with all sub-branches. This 
is demonstrated in the following snippet:</p>
<div class="highlight"><pre><span></span><code><span class="n">new_report</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">mean_across_branches</span><span class="p">,</span> <span class="n">max_abs_across_branches</span><span class="p">)</span>
<span class="n">fb</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">new_report</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Metric          case2           case1           avg             budgetratioabs 
accuracy        0.938           0.938           0.938           0.000          
fpr             0.056           0.071           0.063           0.251          
fnr             0.167           0.500           0.333           1.099    
</code></pre></div>
<p>Sometimes, you may want to compare the same report
generated for multiple algorithms. To do this, you
need to generate a fork where each branch holds
a respective algorithm's default. Then, you can 
extract and combine values for each metric as
shown in the following snipper:</p>
<div class="highlight"><pre><span></span><code><span class="n">reports</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">Fork</span><span class="p">(</span><span class="n">ppr</span><span class="o">=</span><span class="n">report</span><span class="p">,</span> <span class="n">lfpro</span><span class="o">=</span><span class="n">fair_report</span><span class="p">)</span>
<span class="n">rep</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">acc</span><span class="o">=</span><span class="n">reports</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">prule</span><span class="o">=</span><span class="n">reports</span><span class="o">.</span><span class="n">minratio</span><span class="o">.</span><span class="n">pr</span><span class="p">)</span>
<span class="n">fb</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Metric          ppr             lfpro          
acc             0.819           0.826          
prule           0.261           0.957    
</code></pre></div>
<p>When extracting values from reports, you can optionally
omit the final value getter as long as is the same as the
new name. For example, <code>fb.extract(accuracy=reports.mean)</code>
is equivalent to <code>fb.extract(accuracy=reports.mean.accuracy)</code>
given that <code>reports.mean</code> also returns a fork.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ml_integration/" class="btn btn-neutral float-left" title="ML Integration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../distributed/" class="btn btn-neutral float-right" title="Computational branches">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../ml_integration/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../distributed/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../mathjax.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
