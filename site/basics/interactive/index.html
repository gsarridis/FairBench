<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Emmanouil (Manios) Krasanakis" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Interactive visualization - FairBench</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../theme_extend.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Interactive visualization";
        var mkdocs_page_input_path = "basics\\interactive.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../fairbench.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Quickstart</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Basics</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../forks/">Forks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../reports/">Reports</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Interactive visualization</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#perspectives">Perspectives</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#code-based-exploration">Code-based exploration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#branch-explanations">Branch explanations</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#algorithm-comparison">Algorithm comparison</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#start-visualization">Start visualization</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#interface">Interface</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modelcards/">Stamps and model cards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../advanced/metrics/">Performance metrics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../advanced/ml_integration/">ML Integration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../advanced/manipulation/">Report manipulation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../advanced/distributed/">Computational branches</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">FairBench</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Basics &raquo;</li>
      <li>Interactive visualization</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="interactive-visualization">Interactive visualization</h1>
<p>Interactive visualization explores
complex objects generated with  <code>FairBench</code>, such as
comparison of report value explanations,
or of different algorithms. This is done with a user interface
that lets you navigate between various perspectives (see below).
The same exploration can be performed programmatically.</p>
<ol>
<li><a href="#perspectives">Perspectives</a></li>
<li><a href="#start-visualization">Start visualization</a></li>
<li><a href="#interface">Interface</a></li>
</ol>
<h2 id="perspectives">Perspectives</h2>
<p>To delve into complicate comparisons between
subgroups, you need to understand the concept 
of report perspectives. Viewing all values stored in a branch
is one perspective (e.g., <code>report.min</code> to view 
assessments for the worst metric values for that
branch).
But you can also obtain other perspectives, like viewing
all values for the same entry in all branches
(e.g., <code>report.tpr</code> to view true positive
rates across all branches).
Perspectives are equivalent to a combination of 
tensor access alongside a specific dimension.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Perspectives as a programming pattern arise from
FairBench's 
<a href="../../advanced/distributed/#computational-branches">concurrent execution</a>
principle on fork membership access 
and a <code>Forklike</code> datatype used internally. The latter is a
dictionary whose elements can also be accessed like class members. </p>
</div>
<h3 id="code-based-exploration">Code-based exploration</h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This paragraph is under construction.</p>
</div>
<h3 id="branch-explanations">Branch explanations</h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This paragraph is under construction.</p>
</div>
<h3 id="algorithm-comparison">Algorithm comparison</h3>
<p>To compare the same type of reports produced by two different
algorithms, you need to create a fork with the reports as its
branches. In the example below, we use 
<a href="https://github.com/MKLab-ITI/pygrank">pygrank</a>
to run a normal pagerank algorithm and a fairness-aware adaptation
for node recommendation. Any number of algorithms can be assessed with
a FairBench reporting mechanism and combined into a fork. In this case,
the mechanism of choice is the multireport, used with
arguments needed to assess recommendation outcomes. At the end,
a fork is created and, although it can be too complicated to 
show in one figure or table,
you can obtain any perspective and visualize that. 
For example, the snippet below prints a table in the console
that compares algorithms in terms of various base auc measure
reductions.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pygrank</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">fairbench</span> <span class="k">as</span> <span class="nn">fb</span>

<span class="sd">&quot;&quot;&quot;load data and set sensitive attribute&quot;&quot;&quot;</span>
<span class="n">_</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">communities</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">load_datasets_multiple_communities</span><span class="p">([</span><span class="s2">&quot;highschool&quot;</span><span class="p">]))</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">to_signal</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">communities</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">sensitive_signal</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">to_signal</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">communities</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="n">sensitive</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">Fork</span><span class="p">(</span><span class="n">gender</span><span class="o">=</span><span class="n">fb</span><span class="o">.</span><span class="n">categories</span><span class="nd">@sensitive_signal</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">train</span><span class="p">))</span>

<span class="sd">&quot;&quot;&quot;create report for pagerank&quot;&quot;&quot;</span>
<span class="n">algorithm</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">PageRank</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">algorithm</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">multireport</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">scores</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span> <span class="n">sensitive</span><span class="o">=</span><span class="n">sensitive</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;create report for locally fair pagerank&quot;&quot;&quot;</span>
<span class="n">fair_algorithm</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">LFPR</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">redistributor</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">)</span>
<span class="n">fair_scores</span> <span class="o">=</span> <span class="n">fair_algorithm</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">sensitive</span><span class="o">=</span><span class="n">sensitive_signal</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="n">fair_report</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">multireport</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">scores</span><span class="o">=</span><span class="n">fair_scores</span><span class="p">,</span> <span class="n">sensitive</span><span class="o">=</span><span class="n">sensitive</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;combine both reports into one and get the auc perspective&quot;&quot;&quot;</span>
<span class="n">fork</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">Fork</span><span class="p">(</span><span class="n">ppr</span><span class="o">=</span><span class="n">report</span><span class="p">,</span> <span class="n">lfpr</span><span class="o">=</span><span class="n">fair_report</span><span class="p">)</span>
<span class="n">fb</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">fork</span><span class="o">.</span><span class="n">auc</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Metric          ppr             lfpr           
min             0.680           0.589          
wmean           0.780           0.743          
minratio        0.792           0.681          
maxdiff         0.178           0.276          
maxbarea        0.169           0.262          
</code></pre></div>
<h2 id="start-visualization">Start visualization</h2>
<p>To start interactive visualization, call the snippet below
on an object that is a dictionary or fork. 
The call shows the default values for 
optional arguments, which set a report name to be displayed
and whether plots should be horizontally or vertically aligned.
Horizontal alignment lets figures remain
comprehensive during complex intersectional analysis.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">fairbench</span> <span class="k">as</span> <span class="nn">fb</span>

<span class="n">obj</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># the object to explore (e.g., a  report)</span>
<span class="n">fb</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;report&quot;</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>When run in a console, the above code will start a bokeh server
that hosts a dynamic web page and will open the latter
as a tab in your local browser (hard-terminate
the process with ctrl+C to stop the server). When run in a 
Jupyter environment, a bokeh application will
start on the next output cell instead.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>When Jupyter runs on its non-default port,
add a respective argument (e.g., <code>port=8889</code>)
to interactive visualization to set appropriate permissions.</p>
</div>
<h2 id="interface">Interface</h2>
<p>Interactive visualization starts from the top level of 
forks/reports and looks like the figures below. Figures
will appear only if data objects can be visualized. 
The first menu option over the figure controls whether 
to explore data by branches or entries. In the example
below, this means by reduction strategy over subgroups 
or performance metric.</p>
<p><img alt="Branches" src="../../images/interactive_branch.png" />
<img alt="Entries" src="../../images/interactive_entries.png" /></p>
<p>You can focus on a specific branch or entry by clicking on its name 
on buttons over the figure. This will generate the appropriate perspective,
as shown below. Two new options are added: a button to go back to the 
previous perspective and an button to create an explanation perspective.
This last button appears only when you focus on specific branches or entries.
The current perspective always appears on the top. Currently, we are investigating
the minimum reduction strategy of the report. Hover over a bar to view its
exact values.</p>
<p><img alt="Clicking on a branch" src="../../images/interactive_specific.png" /></p>
<p>Let us now view the explanations of what quantities have led to 
computing the values of the current figure by clicking on the explain button.
The report we are exploring (multireport) 
performs reduction on the outcome of performance metrics on each
sensitive attribute branch, i.e., sensitive attribute dimension.
Thus, explanations consist of metric outcomes. Similarly to before, 
you can switch between showing branches and entries of explanation
values.</p>
<p><img alt="Explanation branches" src="../../images/interactive_explain.png" />
<img alt="Explanation entries" src="../../images/interactive_explain_entries.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>FairBench keeps track of metadata when computing base performance 
metrics, and you can eventually view them and compare them 
from within interactive visualization as explanations. For example,
below is the explanation for ''true positive rates of the minimum
reduction's explanation'', as indicated by reading the perspective's 
title <code>report.min.explain.tpr.explain</code> from end to start.
By looking at base metric explanations, you can get a feel
for raw data properties and corresponding systemic, societal,
or data gathering issues
that eventually give rise to bias.<br><br>
<img alt="Explanations of explanations" src="../../images/interactive_internal_explanations.png" /></p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../reports/" class="btn btn-neutral float-left" title="Reports"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../modelcards/" class="btn btn-neutral float-right" title="Stamps and model cards">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../reports/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../modelcards/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../mathjax.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
